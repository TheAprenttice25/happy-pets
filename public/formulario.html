<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="formulario.css" />
  <title>Happy Pets</title>
</head>

<body>

<!-- üîê L√≠nea de control de acceso -->
<script>
  if (localStorage.getItem('logueado') !== 'true') {
    window.location.href = 'login.html';
  }
</script>

<!-- ‚úÖ Barra superior con logo y bot√≥n cerrar sesi√≥n -->
<div class="top-bar" style="display: flex; align-items: center; justify-content: space-between;">
  <div style="display: flex; align-items: center;">
    <img src="Images/Logo.png" alt="Logo" />
    <h1 style="margin-left: 10px;">Registro de hospitalizaci√≥n</h1>
  </div>
  <button id="logoutBtn" type="button" style="
    padding: 8px 12px;
    background-color: #c0392b;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-right: 20px;
  ">
    Cerrar sesi√≥n
  </button>
</div>

<!-- Contenedor principal -->
<div class="container">

  <!-- Imagen izquierda -->
  <div class="image-box image-veterinario"></div>

  <!-- Formulario -->
  <div class="form-container">
    <form id="formulario-hospitalizacion">
      <!-- Datos del due√±o -->
      <div class="form-group">
        <label for="nombre_due√±o">Nombre del Due√±o</label>
        <input type="text" id="nombre_due√±o" name="nombre_due√±o" required />
      </div>
      <div class="form-group">
        <label for="apellido_due√±o">Apellido</label>
        <input type="text" id="apellido_due√±o" name="apellido_due√±o" required />
      </div>
      <div class="form-group">
        <label for="telefono">Tel√©fono</label>
        <input type="tel" id="telefono" name="telefono" />
      </div>
      <div class="form-group">
        <label for="direccion">Direcci√≥n</label>
        <input type="text" id="direccion" name="direccion" />
      </div>

      <!-- Datos de la mascota -->
      <div class="form-group">
        <label for="nombre_mascota">Nombre de la Mascota</label>
        <input type="text" id="nombre_mascota" name="nombre_mascota" />
      </div>
      <div class="form-group">
        <label for="especie">Especie</label>
        <input type="text" id="especie" name="especie" />
      </div>
      <div class="form-group">
        <label for="raza">Raza</label>
        <input type="text" id="raza" name="raza" />
      </div>
      <div class="form-group">
        <label for="edad">Edad</label>
        <input type="number" id="edad" name="edad" min="0" />
      </div>

      <!-- Diagn√≥stico y fechas -->
      <div class="form-group" style="width: 100%;">
        <label for="motivo_consulta">Motivo de la consulta / Descripci√≥n de ingreso</label>
        <textarea id="motivo_consulta" name="motivo_consulta" rows="3" required></textarea>
      </div>
      <div class="form-group" style="width: 100%;">
        <label for="diagnostico">Diagn√≥stico</label>
        <textarea id="diagnostico" name="diagnostico" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label for="fecha_ingreso">Fecha de Ingreso</label>
        <input type="date" id="fecha_ingreso" name="fecha_ingreso" />
      </div>
      <div class="form-group">
        <label for="fecha_salida">Fecha Estimada de Salida</label>
        <input type="date" id="fecha_salida" name="fecha_salida" />
      </div>

      <!-- Bot√≥n enviar -->
      <div class="form-group" style="width: 100%; text-align: center;">
        <button type="submit" class="btn-enviar">Enviar formulario</button>
      </div>
    </form>
  </div>

  <!-- Imagen derecha -->
  <div class="image-box image-mascota"></div>
</div>

<!-- ‚úÖ Script para cerrar sesi√≥n -->
<script>
  document.getElementById('logoutBtn').addEventListener('click', () => {
    fetch('/logout', { method: 'POST' })
      .then(res => {
        if (res.ok) {
          localStorage.removeItem('logueado');
          window.location.href = '/login.html';
        } else {
          console.error('Fallo al cerrar sesi√≥n en backend');
        }
      })
      .catch(err => {
        console.error('Error al cerrar sesi√≥n:', err);
      });
  });
</script>

<!-- ‚úÖ Script para enviar el formulario como JSON -->
<script>
  document.querySelector('#formulario-hospitalizacion').addEventListener('submit', async function (e) {
    e.preventDefault();

    const datos = Object.fromEntries(new FormData(this).entries());

    try {
      const res = await fetch('/registro', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(datos)
      });

      const respuesta = await res.json();
      alert(respuesta.mensaje || '‚úÖ Formulario enviado con √©xito');
      this.reset();
    } catch (error) {
      alert('‚ùå Error al enviar el formulario');
      console.error(error);
    }
  });
</script>

</body>
</html>
